<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Audio Lab // WAV-MIDI-WAV</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/rack.css') }}">
</head>
<body>
    <div class="rack-container">
        <div class="rack-side left"></div>
        <div class="studio-rack">

            <!-- HEADER -->
            <div class="rack-header">
                <div class="brand">NEURAL<span>AUDIO</span> LAB</div>
                <div class="master-vu" id="masterVU">
                    <div class="vu-bar"><div class="vu-fill" id="vu-L" style="width: 0%"></div></div>
                    <div class="vu-bar"><div class="vu-fill" id="vu-R" style="width: 0%"></div></div>
                </div>
                <div class="sys-info">
                    <span class="led-indicator active blink"></span>
                    SYS_READY // SEED: 42 // BUFFER: 44.1kHz
                </div>
            </div>

            <!-- MODULE S: SOURCE SEPARATOR -->
            <div class="rack-module" id="moduleS">
                <div class="vu-meter-v" id="vuMeterS">
                    <div class="segment red"></div>
                    <div class="segment yellow"></div>
                    <div class="segment yellow"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                </div>
                <div class="module-title">Unit 00: Source Separator</div>
                <div class="control-panel">
                <div class="file-drop-zone" id="dropZone">
                    <input type="file" id="audioInput" accept=".wav" hidden>
                    <p>LOAD SOURCE TAPE (.WAV)</p>
                </div>

                <div class="stem-monitor">
                    <div class="stem-led" data-stem="vocals"><span>VOC</span><div class="led"></div></div>
                    <div class="stem-led" data-stem="bass"><span>BAS</span><div class="led"></div></div>
                    <div class="stem-led" data-stem="drums"><span>DRM</span><div class="led"></div></div>
                    <div class="stem-led" data-stem="other"><span>OTH</span><div class="led"></div></div>
                </div>

                <button id="separateBtn" class="rack-btn disabled">Separate Stems</button>
            </div>
            <div class="console-log" id="logSeparate" style="height: 40px;">AWAITING TAPE LOAD...</div>
        </div>

            <!-- MODULE A: TRANSCRIPTION ENGINE -->
            <div class="rack-module" id="moduleA">
                <div class="vu-meter-v" id="vuMeterA">
                    <div class="segment red"></div>
                    <div class="segment yellow"></div>
                    <div class="segment yellow"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                </div>
                <div class="module-title">Track A: Transcription Engine</div>
                <div class="control-panel">
                <div class="stem-selector">
                    <label class="knob-label">Target Stem</label>
                    <select id="stemSelect" class="led-display" style="margin-top: 10px; width: 100px;">
                        <option value="original">Original</option>
                        <option value="vocals">Vocals</option>
                        <option value="bass">Bass</option>
                        <option value="drums">Drums</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="knob-container">
                    <span class="knob-label">Threshold</span>
                    <div class="knob-wrapper">
                        <div class="knob" id="thresholdKnob" data-min="0.1" data-max="0.9" data-value="0.6">
                            <div class="knob-indicator"></div>
                        </div>
                    </div>
                    <span id="threshValue" class="led-display">0.60</span>
                </div>

                <button id="transcribeBtn" class="rack-btn disabled">Initiate Track A</button>
            </div>

            <canvas id="inputCanvas" width="820" height="120"></canvas>
            <div class="console-log" id="logTrackA">SYSTEM IDLE. AWAITING INPUT...</div>
        </div>

            <!-- MODULE B: EXPRESSIVE RENDERER -->
            <div class="rack-module" id="moduleB">
                <div class="vu-meter-v" id="vuMeterB">
                    <div class="segment red"></div>
                    <div class="segment yellow"></div>
                    <div class="segment yellow"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                    <div class="segment green"></div>
                </div>
                <div class="module-title">Track B: Expressive Renderer</div>
                <div class="control-panel">
                <div class="knob-container">
                    <span class="knob-label">Humanize</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="humanizeSwitch" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="knob-container">
                    <span class="knob-label">Seed</span>
                    <input type="number" id="seedInput" value="42" class="led-display" style="width: 60px; height: 30px; margin-top: 10px;">
                </div>

                <button id="renderBtn" class="rack-btn disabled">Render Track B</button>
            </div>

            <canvas id="outputCanvas" width="820" height="120"></canvas>

            <div class="metrics-grid" id="metricsDisplay">
                <div class="metric-box">
                    <span class="label">Spectral MSE</span>
                    <span class="value" id="val-mse">--.--</span>
                </div>
                <div class="metric-box">
                    <span class="label">Note F1</span>
                    <span class="value" id="val-f1">--.--</span>
                </div>
                <div class="metric-box">
                    <span class="label">MFCC Dist</span>
                    <span class="value" id="val-mfcc">--.--</span>
                </div>
            </div>

            <div style="margin-top: 20px; display: flex; align-items: center; gap: 20px;">
                <audio id="audioPlayer" controls style="flex: 1;"></audio>
                <div id="renderStatus" class="sys-info" style="font-size: 10px;">
                    <span class="led-indicator" id="statusLed"></span>
                    <span id="statusText">OUTPUT: NONE</span>
                </div>
            </div>
            </div>

        </div>
        <div class="rack-side right"></div>
    </div>
    <script src="{{ url_for('static', filename='js/deck.js') }}"></script>
</body>
</html>
